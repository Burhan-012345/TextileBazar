<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Statistics - Textile Bazar</title>
    <style>
        :root {
            --primary-blue: #0066CC;
            --primary-light: #4D94FF;
            --primary-dark: #004C99;
            --secondary-blue: #3399FF;
            --accent-blue: #66B2FF;
            --light-blue: #E6F2FF;
            --very-light-blue: #F0F8FF;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #3399FF;
            --text-dark: #333333;
            --text-medium: #666666;
            --text-light: #999999;
            --border-color: #D6E4FF;
            --card-shadow: 0 4px 12px rgba(0, 102, 204, 0.08);
            --card-shadow-hover: 0 8px 24px rgba(0, 102, 204, 0.12);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #F8FAFF;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .stats-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .stats-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            border-radius: 16px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .stats-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.1;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-30px, -30px) rotate(360deg); }
        }

        .stats-header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .stats-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow-hover);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-blue), var(--primary-light));
            border-radius: 3px 0 0 3px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--light-blue);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: var(--primary-blue);
            font-size: 1.8rem;
        }

        .stat-title {
            font-size: 1rem;
            color: var(--text-medium);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
            line-height: 1;
        }

        .stat-subtitle {
            font-size: 0.95rem;
            color: var(--text-light);
        }

        /* Chart Container */
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .chart-header h2 {
            color: var(--primary-dark);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .chart-placeholder {
            height: 300px;
            background: linear-gradient(to right, var(--very-light-blue), var(--light-blue));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-size: 1.2rem;
            font-weight: 500;
        }

        /* Table Styles */
        .table-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .table-header h2 {
            color: var(--primary-dark);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .stats-table thead {
            background: linear-gradient(to right, var(--primary-blue), var(--primary-light));
            color: white;
        }

        .stats-table th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        .stats-table th:first-child {
            border-radius: 10px 0 0 0;
        }

        .stats-table th:last-child {
            border-radius: 0 10px 0 0;
        }

        .stats-table tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .stats-table tbody tr:hover {
            background-color: var(--very-light-blue);
        }

        .stats-table td {
            padding: 16px 15px;
            color: var(--text-dark);
        }

        .stats-table .highlight {
            color: var(--primary-blue);
            font-weight: 600;
        }

        /* Status Indicators */
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-high {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .status-medium {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .status-low {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .summary-card {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--card-shadow);
        }

        .summary-card.light {
            background: linear-gradient(135deg, var(--secondary-blue), var(--primary-light));
        }

        .summary-card .summary-value {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            line-height: 1;
        }

        .summary-card .summary-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Footer */
        .stats-footer {
            text-align: center;
            padding: 30px;
            color: var(--text-medium);
            font-size: 0.95rem;
            border-top: 1px solid var(--border-color);
            margin-top: 20px;
        }

        .stats-footer a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .stats-footer a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .stats-container {
                padding: 15px;
            }

            .stats-header h1 {
                font-size: 2.2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 25px;
            }

            .stat-value {
                font-size: 2rem;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--very-light-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-blue);
        }

        /* Print Styles */
        @media print {
            .stat-card:hover,
            .stats-table tbody tr:hover {
                transform: none;
                background-color: transparent;
            }
            
            .chart-placeholder {
                border: 1px solid var(--border-color);
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .mt-30 { margin-top: 30px; }

        /* Progress Bars */
        .progress-container {
            margin: 10px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-medium);
        }

        .progress-bar {
            height: 8px;
            background-color: var(--light-blue);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-blue), var(--primary-light));
            border-radius: 4px;
            transition: width 1s ease-in-out;
        }

        /* Payment Method Badges */
        .method-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .method-cash {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(40, 167, 69, 0.2);
        }

        .method-upi {
            background-color: rgba(0, 102, 204, 0.1);
            color: var(--primary-blue);
            border: 1px solid rgba(0, 102, 204, 0.2);
        }

        /* Payment Method Stats */
        .method-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .method-stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .method-stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
        }

        .method-stat-icon.cash {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .method-stat-icon.upi {
            background-color: rgba(0, 102, 204, 0.1);
            color: var(--primary-blue);
        }

        .method-stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .method-stat-label {
            font-size: 0.9rem;
            color: var(--text-medium);
        }
    </style>
</head>
<body>
    <div class="stats-container">
        <!-- Header -->
        <header class="stats-header fade-in">
            <h1>üìä Business Statistics</h1>
            <p>Comprehensive overview of your Textile Bazar performance and analytics</p>
            <div class="text-center mt-20">
                <small>Last updated: {{ current_date }} | Generated at {{ datetime.now().strftime('%H:%M:%S') }}</small>
            </div>
        </header>

        <!-- Summary Cards -->
        <div class="summary-cards fade-in">
            <div class="summary-card">
                <div class="summary-value">{{ format_rupees(stats.grand_total) }}</div>
                <div class="summary-label">Total Revenue</div>
            </div>
            <div class="summary-card light">
                <div class="summary-value">{{ stats.total_customers }}</div>
                <div class="summary-label">Total Customers</div>
            </div>
            <div class="summary-card">
                <div class="summary-value">{{ stats.total_transactions }}</div>
                <div class="summary-label">Total Transactions</div>
            </div>
            <div class="summary-card light">
                <div class="summary-value">{{ stats.total_items }}</div>
                <div class="summary-label">Total Items Sold</div>
            </div>
        </div>

        <!-- Payment Method Statistics -->
        <div class="chart-container fade-in">
            <div class="chart-header">
                <h2>Payment Methods Overview</h2>
                <div class="status-badge status-high">Current Period</div>
            </div>
            
            <div class="method-stats">
                <div class="method-stat-card">
                    <div class="method-stat-icon cash">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="method-stat-value">{{ format_rupees(stats.cash_total|default(0)) }}</div>
                    <div class="method-stat-label">Cash Payments</div>
                    <div class="progress-container mt-10">
                        <div class="progress-label">
                            <span>Transactions:</span>
                            <span>{{ stats.cash_count|default(0) }}</span>
                        </div>
                        <div class="progress-bar">
                            {% set cash_percentage = (stats.cash_count|default(0) / stats.total_transactions * 100) if stats.total_transactions > 0 else 0 %}
                            <div class="progress-fill" style="width: {{ cash_percentage|clamp(0, 100) }}%; background: linear-gradient(to right, #28a745, #20c997);"></div>
                        </div>
                    </div>
                </div>
                
                <div class="method-stat-card">
                    <div class="method-stat-icon upi">
                        <i class="fas fa-qrcode"></i>
                    </div>
                    <div class="method-stat-value">{{ format_rupees(stats.upi_total|default(0)) }}</div>
                    <div class="method-stat-label">UPI Payments</div>
                    <div class="progress-container mt-10">
                        <div class="progress-label">
                            <span>Transactions:</span>
                            <span>{{ stats.upi_count|default(0) }}</span>
                        </div>
                        <div class="progress-bar">
                            {% set upi_percentage = (stats.upi_count|default(0) / stats.total_transactions * 100) if stats.total_transactions > 0 else 0 %}
                            <div class="progress-fill" style="width: {{ upi_percentage|clamp(0, 100) }}%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card fade-in">
                <div class="stat-icon">
                    üìÖ
                </div>
                <div class="stat-title">Business Duration</div>
                <div class="stat-value">{{ stats.total_days }} days</div>
                <div class="stat-subtitle">
                    From {{ stats.first_date }} to {{ stats.last_date }}
                </div>
            </div>

            <div class="stat-card fade-in">
                <div class="stat-icon">
                    üí∞
                </div>
                <div class="stat-title">Average Price</div>
                <div class="stat-value">{{ format_rupees(stats.avg_price) }}</div>
                <div class="stat-subtitle">
                    Per item across all transactions
                </div>
            </div>

            <div class="stat-card fade-in">
                <div class="stat-icon">
                    üë•
                </div>
                <div class="stat-title">Customer Activity</div>
                <div class="stat-value">
                    {% if stats.total_customers > 0 %}
                        {{ (stats.total_transactions / stats.total_customers)|round(1) }}
                    {% else %}
                        0
                    {% endif %}
                </div>
                <div class="stat-subtitle">
                    Avg transactions per customer
                </div>
            </div>

            <div class="stat-card fade-in">
                <div class="stat-icon">
                    üìà
                </div>
                <div class="stat-title">Daily Average</div>
                <div class="stat-value">
                    {% if stats.total_days > 0 %}
                        {{ format_rupees(stats.grand_total / stats.total_days) }}
                    {% else %}
                        ‚Çπ0.00
                    {% endif %}
                </div>
                <div class="stat-subtitle">
                    Revenue per day
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="chart-container fade-in">
            <div class="chart-header">
                <h2>Revenue Trends</h2>
                <div class="status-badge status-high">Active</div>
            </div>
            <div class="chart-placeholder">
                <div class="text-center">
                    <div style="font-size: 4rem; margin-bottom: 10px;">üìà</div>
                    <div>Revenue Analytics Chart</div>
                    <small class="text-light" style="display: block; margin-top: 10px;">
                        Visual representation of sales performance over time
                    </small>
                </div>
            </div>
        </div>

        <!-- Recent Dates Table -->
        <div class="table-container fade-in">
            <div class="table-header">
                <h2>Recent Daily Performance</h2>
                <div class="status-badge status-medium">Last 10 Days</div>
            </div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Revenue</th>
                        <th>Transactions</th>
                        <th>Customers</th>
                        <th>Payment Methods</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for day in recent_dates %}
                    <tr>
                        <td class="highlight">{{ day.date }}</td>
                        <td>{{ format_rupees(day.daily_total) }}</td>
                        <td>{{ day.transaction_count }}</td>
                        <td>{{ day.customer_count }}</td>
                        <td>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                {% if day.cash_total and day.cash_total > 0 %}
                                <span class="method-badge method-cash">
                                    <i class="fas fa-money-bill-wave"></i> ‚Çπ{{ day.cash_total|format_rupees_no_symbol }}
                                </span>
                                {% endif %}
                                {% if day.upi_total and day.upi_total > 0 %}
                                <span class="method-badge method-upi">
                                    <i class="fas fa-qrcode"></i> ‚Çπ{{ day.upi_total|format_rupees_no_symbol }}
                                </span>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            {% if day.daily_total > (stats.grand_total / stats.total_days) %}
                                <span class="status-badge status-high">High</span>
                            {% elif day.daily_total > (stats.grand_total / stats.total_days) * 0.5 %}
                                <span class="status-badge status-medium">Medium</span>
                            {% else %}
                                <span class="status-badge status-low">Low</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Top Customers -->
        <div class="table-container fade-in">
            <div class="table-header">
                <h2>Top 10 Customers</h2>
                <div class="status-badge status-high">VIP Customers</div>
            </div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Customer Name</th>
                        <th>Phone</th>
                        <th>Total Spent</th>
                        <th>Items</th>
                        <th>Transactions</th>
                        <th>Preferred Method</th>
                        <th>Loyalty Level</th>
                    </tr>
                </thead>
                <tbody>
                    {% for customer in top_customers %}
                    <tr>
                        <td class="highlight">{{ customer.customer_name }}</td>
                        <td>{{ format_phone(customer.phone_number) }}</td>
                        <td>{{ format_rupees(customer.total_spent) }}</td>
                        <td>{{ customer.total_items }}</td>
                        <td>{{ customer.transaction_count }}</td>
                        <td>
                            {% if customer.cash_total and customer.cash_total > customer.upi_total %}
                            <span class="method-badge method-cash">
                                <i class="fas fa-money-bill-wave"></i> Cash
                            </span>
                            {% else %}
                            <span class="method-badge method-upi">
                                <i class="fas fa-qrcode"></i> UPI
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if customer.total_spent > (stats.grand_total / stats.total_customers) * 3 %}
                                <span class="status-badge status-high">Platinum</span>
                            {% elif customer.total_spent > (stats.grand_total / stats.total_customers) * 1.5 %}
                                <span class="status-badge status-medium">Gold</span>
                            {% else %}
                                <span class="status-badge status-low">Silver</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Top Items -->
        <div class="table-container fade-in">
            <div class="table-header">
                <h2>Top 10 Selling Items</h2>
                <div class="status-badge status-high">Best Sellers</div>
            </div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Revenue</th>
                        <th>Quantity</th>
                        <th>Customers</th>
                        <th>Performance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_items %}
                    <tr>
                        <td class="highlight">{{ item.item_name }}</td>
                        <td>{{ format_rupees(item.item_total) }}</td>
                        <td>{{ item.total_quantity }}</td>
                        <td>{{ item.customer_count }}</td>
                        <td>
                            {% set avg_revenue = item.item_total / item.total_quantity if item.total_quantity > 0 else 0 %}
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Revenue per item:</span>
                                    <span>{{ format_rupees(avg_revenue) }}</span>
                                </div>
                                <div class="progress-bar">
                                    {% set progress = (avg_revenue / stats.avg_price) * 100 if stats.avg_price > 0 else 0 %}
                                    <div class="progress-fill" style="width: {{ progress|clamp(0, 100) }}%;"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Payment Methods Breakdown -->
        <div class="chart-container fade-in">
            <div class="chart-header">
                <h2>Payment Methods Performance</h2>
                <div class="status-badge status-medium">Current Month</div>
            </div>
            <div class="chart-placeholder">
                <div class="text-center">
                    <div style="font-size: 4rem; margin-bottom: 10px;">üí≥</div>
                    <div>Payment Methods Distribution</div>
                    <small class="text-light" style="display: block; margin-top: 10px;">
                        Cash vs UPI payments breakdown
                    </small>
                </div>
            </div>
            
            <!-- Payment method table -->
            <div class="mt-30">
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Payment Method</th>
                            <th>Count</th>
                            <th>Amount</th>
                            <th>Percentage</th>
                            <th>Avg. Transaction</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="highlight">
                                <span class="method-badge method-cash">
                                    <i class="fas fa-money-bill-wave"></i> Cash
                                </span>
                            </td>
                            <td>{{ payment_stats.cash_count|default(0) }}</td>
                            <td>{{ format_rupees(payment_stats.cash_amount|default(0)) }}</td>
                            <td>
                                {% set cash_percentage = (payment_stats.cash_count|default(0) / payment_stats.total_transactions|default(1) * 100) if payment_stats.total_transactions|default(0) > 0 else 0 %}
                                {{ cash_percentage|round(1) }}%
                            </td>
                            <td>
                                {% set cash_avg = (payment_stats.cash_amount|default(0) / payment_stats.cash_count|default(1)) if payment_stats.cash_count|default(0) > 0 else 0 %}
                                {{ format_rupees(cash_avg) }}
                            </td>
                        </tr>
                        <tr>
                            <td class="highlight">
                                <span class="method-badge method-upi">
                                    <i class="fas fa-qrcode"></i> UPI
                                </span>
                            </td>
                            <td>{{ payment_stats.upi_count|default(0) }}</td>
                            <td>{{ format_rupees(payment_stats.upi_amount|default(0)) }}</td>
                            <td>
                                {% set upi_percentage = (payment_stats.upi_count|default(0) / payment_stats.total_transactions|default(1) * 100) if payment_stats.total_transactions|default(0) > 0 else 0 %}
                                {{ upi_percentage|round(1) }}%
                            </td>
                            <td>
                                {% set upi_avg = (payment_stats.upi_amount|default(0) / payment_stats.upi_count|default(1)) if payment_stats.upi_count|default(0) > 0 else 0 %}
                                {{ format_rupees(upi_avg) }}
                            </td>
                        </tr>
                        <tr style="font-weight: bold; background-color: #f8f9fa;">
                            <td>Total</td>
                            <td>{{ payment_stats.total_transactions|default(0) }}</td>
                            <td>{{ format_rupees(payment_stats.total_received|default(0)) }}</td>
                            <td>100%</td>
                            <td>
                                {% set total_avg = (payment_stats.total_received|default(0) / payment_stats.total_transactions|default(1)) if payment_stats.total_transactions|default(0) > 0 else 0 %}
                                {{ format_rupees(total_avg) }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Monthly Summary -->
        <div class="chart-container fade-in">
            <div class="chart-header">
                <h2>Monthly Performance (Last 6 Months)</h2>
                <div class="status-badge status-medium">Trend Analysis</div>
            </div>
            <div class="chart-placeholder">
                <div class="text-center">
                    <div style="font-size: 4rem; margin-bottom: 10px;">üìä</div>
                    <div>Monthly Revenue Chart</div>
                    <small class="text-light" style="display: block; margin-top: 10px;">
                        Shows monthly revenue, transactions, and customer trends
                    </small>
                </div>
            </div>
            
            <!-- Monthly Summary Table -->
            <div class="mt-30">
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Customers</th>
                            <th>Transactions</th>
                            <th>Revenue</th>
                            <th>Quantity</th>
                            <th>Avg. Revenue</th>
                            <th>Cash/UPI</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for month in monthly_summary %}
                        <tr>
                            <td class="highlight">{{ month.month }}</td>
                            <td>{{ month.customer_count }}</td>
                            <td>{{ month.transaction_count }}</td>
                            <td>{{ format_rupees(month.monthly_total) }}</td>
                            <td>{{ month.monthly_quantity }}</td>
                            <td>
                                {% if month.transaction_count > 0 %}
                                    {{ format_rupees(month.monthly_total / month.transaction_count) }}
                                {% else %}
                                    ‚Çπ0.00
                                {% endif %}
                            </td>
                            <td>
                                <div style="display: flex; gap: 3px; font-size: 0.8rem;">
                                    <span title="Cash" style="color: #28a745;">C:{{ month.cash_count|default(0) }}</span>
                                    <span style="color: #ccc;">|</span>
                                    <span title="UPI" style="color: #0066CC;">U:{{ month.upi_count|default(0) }}</span>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <footer class="stats-footer fade-in">
            <p>
                üìç <strong>Textile Bazar Statistics Report</strong> | 
                Generated on {{ datetime.now().strftime('%B %d, %Y at %I:%M %p') }}
            </p>
            <p class="mt-20">
                <a href="/home">‚Üê Return to Dashboard</a> | 
                <a href="javascript:window.print()">üñ®Ô∏è Print Report</a> | 
                <a href="/stats?refresh=1">üîÑ Refresh Data</a>
            </p>
            <p class="mt-20" style="font-size: 0.85rem; color: var(--text-light);">
                Note: All amounts are in Indian Rupees (INR ‚Çπ). Statistics update in real-time.
                <br>Payment Methods: Cash üíµ | UPI üì±
                <br>For detailed reports, visit the <a href="/inventory/report">Inventory Report</a> section.
            </p>
        </footer>
    </div>

    <script>
        // Add animation on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);

        // Observe all stat cards and containers
        document.querySelectorAll('.stat-card, .chart-container, .table-container, .method-stat-card').forEach(el => {
            observer.observe(el);
        });

        // Auto-refresh page every 5 minutes (300000 ms)
        setTimeout(() => {
            window.location.reload();
        }, 300000);

        // Add click animation to stat cards
        document.querySelectorAll('.stat-card, .method-stat-card').forEach(card => {
            card.addEventListener('click', function() {
                this.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        // Progress bar animation
        document.addEventListener('DOMContentLoaded', function() {
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 300);
            });
        });

        // Add a custom Jinja2 filter for clamping values
        function clamp(value, min, max) {
            return Math.min(Math.max(value, min), max);
        }

        // Make it available globally
        window.clamp = clamp;
    </script>
</body>
</html>