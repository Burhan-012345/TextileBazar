{% extends "base.html" %}

{% block title %}Inventory Report{% endblock %}

{% block content %}
<style>
    /* Inventory Report Page Styles */
    :root {
        --primary-blue: #0066CC;
        --light-blue: #E6F2FF;
        --dark-blue: #004C99;
        --success-green: #28a745;
        --warning-orange: #ffc107;
        --danger-red: #dc3545;
        --info-teal: #17a2b8;
        --pure-white: #FFFFFF;
        --light-bg: #F8F9FA;
        --border-color: #E9ECEF;
    }
    
    .inventory-report-container {
        background: linear-gradient(135deg, var(--light-bg) 0%, var(--light-blue) 100%);
        min-height: calc(100vh - 200px);
        padding: 20px 0;
    }
    
    .report-header {
        background: var(--pure-white);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 102, 204, 0.1);
        padding: 25px;
        margin-bottom: 25px;
        border-left: 5px solid var(--primary-blue);
        position: relative;
        overflow: hidden;
    }
    
    .report-header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 200px;
        background: linear-gradient(135deg, rgba(0, 102, 204, 0.05) 0%, rgba(0, 102, 204, 0.02) 100%);
        border-radius: 50%;
        transform: translate(50%, -50%);
    }
    
    .stats-cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }
    
    .stat-card {
        background: var(--pure-white);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 102, 204, 0.08);
        transition: all 0.3s ease;
        border-top: 4px solid var(--primary-blue);
        position: relative;
        overflow: hidden;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 102, 204, 0.15);
    }
    
    .stat-card.alert {
        border-top-color: var(--danger-red);
        animation: pulse 2s infinite;
    }
    
    .stat-card.warning {
        border-top-color: var(--warning-orange);
    }
    
    .stat-card.success {
        border-top-color: var(--success-green);
    }
    
    .stat-card.info {
        border-top-color: var(--info-teal);
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 4px 12px rgba(220, 53, 69, 0.1); }
        50% { box-shadow: 0 4px 20px rgba(220, 53, 69, 0.2); }
        100% { box-shadow: 0 4px 12px rgba(220, 53, 69, 0.1); }
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 1.5rem;
    }
    
    .stat-icon.blue {
        background: linear-gradient(135deg, rgba(0, 102, 204, 0.1) 0%, rgba(0, 102, 204, 0.05) 100%);
        color: var(--primary-blue);
    }
    
    .stat-icon.green {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
        color: var(--success-green);
    }
    
    .stat-icon.orange {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
        color: var(--warning-orange);
    }
    
    .stat-icon.red {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
        color: var(--danger-red);
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        margin: 10px 0;
        color: var(--dark-blue);
        line-height: 1.2;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
    }
    
    .btn-export {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-export:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 102, 204, 0.2);
        color: white;
    }
    
    .btn-export.pdf {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    }
    
    .btn-export.pdf:hover {
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
    }
    
    .btn-export.print {
        background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
    }
    
    .btn-export.print:hover {
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.2);
    }
    
    .section-card {
        background: var(--pure-white);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 102, 204, 0.1);
        margin-bottom: 25px;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .section-card:hover {
        box-shadow: 0 6px 18px rgba(0, 102, 204, 0.15);
    }
    
    .section-header {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        color: white;
        padding: 18px 25px;
        border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .section-header h3 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .section-badge {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .inventory-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }
    
    .inventory-table th {
        background-color: var(--light-blue);
        color: var(--dark-blue);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
        padding: 15px;
        border-bottom: 2px solid var(--border-color);
        text-align: left;
        white-space: nowrap;
    }
    
    .inventory-table td {
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        vertical-align: middle;
        transition: all 0.2s ease;
    }
    
    .inventory-table tbody tr {
        transition: all 0.3s ease;
    }
    
    .inventory-table tbody tr:hover {
        background-color: rgba(0, 102, 204, 0.03);
        transform: scale(1.002);
    }
    
    .inventory-table tbody tr.low-stock {
        background-color: rgba(255, 193, 7, 0.05);
        border-left: 3px solid var(--warning-orange);
    }
    
    .inventory-table tbody tr.out-of-stock {
        background-color: rgba(220, 53, 69, 0.05);
        border-left: 3px solid var(--danger-red);
    }
    
    .stock-indicator {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .stock-indicator.good {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success-green);
        border: 1px solid rgba(40, 167, 69, 0.2);
    }
    
    .stock-indicator.low {
        background: rgba(255, 193, 7, 0.1);
        color: var(--warning-orange);
        border: 1px solid rgba(255, 193, 7, 0.2);
    }
    
    .stock-indicator.out {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger-red);
        border: 1px solid rgba(220, 53, 69, 0.2);
    }
    
    .category-badge {
        background: linear-gradient(135deg, rgba(0, 102, 204, 0.1) 0%, rgba(0, 102, 204, 0.05) 100%);
        color: var(--primary-blue);
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        border: 1px solid rgba(0, 102, 204, 0.2);
    }
    
    .progress-container {
        width: 100px;
        background: var(--light-bg);
        border-radius: 10px;
        height: 10px;
        overflow: hidden;
    }
    
    .progress-bar {
        height: 100%;
        border-radius: 10px;
        transition: width 0.3s ease;
    }
    
    .progress-bar.good {
        background: linear-gradient(90deg, var(--success-green) 0%, #4cd964 100%);
    }
    
    .progress-bar.low {
        background: linear-gradient(90deg, var(--warning-orange) 0%, #ffd54f 100%);
    }
    
    .progress-bar.critical {
        background: linear-gradient(90deg, var(--danger-red) 0%, #ff6b6b 100%);
    }
    
    .category-summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        padding: 20px;
    }
    
    .category-item {
        background: var(--light-bg);
        border-radius: 10px;
        padding: 15px;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }
    
    .category-item:hover {
        background: var(--light-blue);
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0, 102, 204, 0.1);
    }
    
    .category-name {
        color: var(--dark-blue);
        font-weight: 600;
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .category-stats {
        font-size: 0.9rem;
        color: #666;
        display: flex;
        flex-direction: column;
        gap: 3px;
    }
    
    .no-data-card {
        padding: 40px 20px;
        text-align: center;
        color: #666;
    }
    
    .no-data-icon {
        font-size: 3rem;
        color: var(--light-blue);
        margin-bottom: 15px;
        opacity: 0.5;
    }
    
    /* Filter Controls */
    .filter-controls {
        background: var(--pure-white);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 102, 204, 0.08);
        border: 1px solid var(--border-color);
    }
    
    .filter-group {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .filter-btn {
        background: var(--pure-white);
        border: 2px solid var(--border-color);
        color: #666;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }
    
    .filter-btn:hover {
        border-color: var(--primary-blue);
        color: var(--primary-blue);
    }
    
    .filter-btn.active {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        border-color: var(--primary-blue);
        color: white;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .stats-cards-container {
            grid-template-columns: 1fr;
        }
        
        .section-header {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }
        
        .inventory-table {
            display: block;
            overflow-x: auto;
        }
        
        .action-buttons {
            justify-content: center;
        }
        
        .filter-group {
            justify-content: center;
        }
    }
    
    @media print {
        .action-buttons,
        .filter-controls {
            display: none;
        }
        
        .section-card {
            box-shadow: none;
            border: 1px solid #ddd;
        }
        
        .inventory-table {
            page-break-inside: avoid;
        }
    }
</style>

<div class="inventory-report-container">
    <!-- Report Header -->
    <div class="report-header">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
            <div>
                <h1 class="mb-2" style="color: var(--primary-blue);">
                    <i class="fas fa-chart-line me-2"></i>
                    Inventory Analysis Report
                </h1>
                <p class="text-muted mb-0">
                    Comprehensive overview of stock levels, values, and inventory performance
                </p>
                <small class="text-muted">
                    Generated on {{ current_date }} | Auto-refresh every 30 minutes
                </small>
            </div>
            <div class="action-buttons">
<a href="{{ url_for('inventory_pdf_template') }}" target="_blank" class="btn-export pdf">
    <i class="fas fa-file-pdf"></i> Export PDF
</a>
                <button onclick="window.print()" class="btn-export print">
                    <i class="fas fa-print"></i> Print Report
                </button>
                <a href="{{ url_for('inventory') }}" class="btn-export">
                    <i class="fas fa-arrow-left"></i> Back to Inventory
                </a>
            </div>
        </div>
    </div>

    <!-- Filter Controls -->
    <div class="filter-controls">
        <div class="filter-group">
            <span class="text-muted me-2"><i class="fas fa-filter"></i> Filter:</span>
            <a href="{{ url_for('inventory_report') }}" class="filter-btn {{ 'active' if not request.args.get('filter') }}">
                <i class="fas fa-layer-group"></i> All Items
            </a>
            <a href="{{ url_for('inventory_report') }}?filter=low" class="filter-btn {{ 'active' if request.args.get('filter') == 'low' }}">
                <i class="fas fa-exclamation-triangle"></i> Low Stock
            </a>
            <a href="{{ url_for('inventory_report') }}?filter=out" class="filter-btn {{ 'active' if request.args.get('filter') == 'out' }}">
                <i class="fas fa-times-circle"></i> Out of Stock
            </a>
            <a href="{{ url_for('inventory_report') }}?filter=category" class="filter-btn {{ 'active' if request.args.get('filter') == 'category' }}">
                <i class="fas fa-tags"></i> By Category
            </a>
        </div>
    </div>

    <!-- Summary Statistics -->
    <div class="stats-cards-container">
        <div class="stat-card">
            <div class="stat-icon blue">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="stat-value">{{ stats.total_items or 0 }}</div>
            <div class="stat-label">Total Items in Inventory</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> Active items in stock
            </div>
        </div>
        
        <div class="stat-card success">
            <div class="stat-icon green">
                <i class="fas fa-box"></i>
            </div>
            <div class="stat-value">{{ stats.total_stock or 0 }}</div>
            <div class="stat-label">Total Stock Units</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> Physical units available
            </div>
        </div>
        
        <div class="stat-card warning">
            <div class="stat-icon orange">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-value">{{ stats.low_stock_count or 0 }}</div>
            <div class="stat-label">Low Stock Items</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> Below minimum stock level
            </div>
        </div>
        
        <div class="stat-card info">
            <div class="stat-icon blue">
                <i class="fas fa-rupee-sign"></i>
            </div>
            <div class="stat-value">{{ format_rupees(stats.total_inventory_value or 0) }}</div>
            <div class="stat-label">Inventory Value</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> Based on cost price
            </div>
        </div>
    </div>

    <!-- Financial Summary Cards -->
    <div class="stats-cards-container">
        <div class="stat-card">
            <div class="stat-icon green">
                <i class="fas fa-chart-bar"></i>
            </div>
            <div class="stat-value">{{ format_rupees(stats.total_potential_value or 0) }}</div>
            <div class="stat-label">Potential Sales Value</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> Based on selling price
            </div>
        </div>
        
        <div class="stat-card info">
            <div class="stat-icon blue">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-value">{{ stats.total_items_sold or 0 }}</div>
            <div class="stat-label">Total Items Sold</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> All-time sales count
            </div>
        </div>
        
        <div class="stat-card success">
            <div class="stat-icon green">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-value">{{ format_rupees(stats.total_sales_value or 0) }}</div>
            <div class="stat-label">Total Sales Revenue</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> Revenue from sold items
            </div>
        </div>
        
        <div class="stat-card warning">
            <div class="stat-icon orange">
                <i class="fas fa-percentage"></i>
            </div>
            <div class="stat-value">
                {% if stats.total_potential_value and stats.total_inventory_value and stats.total_inventory_value > 0 %}
                    {{ (((stats.total_potential_value - stats.total_inventory_value) / stats.total_inventory_value) * 100)|round(1) }}%
                {% else %}
                    0%
                {% endif %}
            </div>
            <div class="stat-label">Average Margin</div>
            <div class="text-muted small mt-2">
                <i class="fas fa-info-circle me-1"></i> Potential profit margin
            </div>
        </div>
    </div>

    <!-- Detailed Inventory Table -->
    <div class="section-card">
        <div class="section-header">
            <h3><i class="fas fa-table"></i> Detailed Inventory List</h3>
            <span class="section-badge">{{ items_with_sales|length }} Items</span>
        </div>
        <div class="table-responsive">
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Item Code</th>
                        <th>Item Name</th>
                        <th>Category</th>
                        <th>Current Stock</th>
                        <th>Min Stock</th>
                        <th>Stock Status</th>
                        <th>Cost Price</th>
                        <th>Selling Price</th>
                        <th>Total Sold</th>
                        <th>Sales Revenue</th>
                        <th>Stock Progress</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items_with_sales %}
                    <tr class="{% if item.current_stock <= 0 %}out-of-stock{% elif item.current_stock <= item.minimum_stock %}low-stock{% endif %}">
                        <td>
                            <strong style="color: var(--dark-blue);">{{ item.item_code }}</strong>
                        </td>
                        <td>
                            <strong>{{ item.item_name }}</strong>
                            {% if item.description %}
                            <br><small class="text-muted">{{ item.description|truncate(30) }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="category-badge">{{ item.category }}</span>
                        </td>
                        <td class="text-center">
                            <strong style="color: var(--dark-blue);">{{ item.current_stock }}</strong>
                            <small class="text-muted d-block">{{ item.unit }}</small>
                        </td>
                        <td class="text-center">
                            {{ item.minimum_stock }}
                        </td>
                        <td>
                            {% if item.current_stock <= 0 %}
                                <span class="stock-indicator out">
                                    <i class="fas fa-times-circle"></i> Out of Stock
                                </span>
                            {% elif item.current_stock <= item.minimum_stock %}
                                <span class="stock-indicator low">
                                    <i class="fas fa-exclamation-triangle"></i> Low Stock
                                </span>
                            {% else %}
                                <span class="stock-indicator good">
                                    <i class="fas fa-check-circle"></i> Good
                                </span>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            <strong>{{ format_rupees(item.cost_price) }}</strong>
                        </td>
                        <td class="text-end">
                            <strong style="color: var(--success-green);">{{ format_rupees(item.selling_price) }}</strong>
                        </td>
                        <td class="text-center">
                            {{ item.total_sold_quantity or 0 }}
                        </td>
                        <td class="text-end">
                            {% if item.total_sales_revenue %}
                                <strong style="color: var(--primary-blue);">{{ format_rupees(item.total_sales_revenue) }}</strong>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="progress-container">
                                    {% set max_stock = [item.current_stock + item.minimum_stock, 50]|max %}
                                    {% set progress_percent = (item.current_stock / max_stock * 100)|round if max_stock > 0 else 0 %}
                                    <div class="progress-bar 
                                        {% if item.current_stock <= 0 %}critical
                                        {% elif item.current_stock <= item.minimum_stock %}low
                                        {% else %}good{% endif %}"
                                        style="width: {{ progress_percent }}%">
                                    </div>
                                </div>
                                <small class="text-muted" style="min-width: 35px;">{{ progress_percent }}%</small>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="11" class="text-center py-5">
                            <div class="no-data-card">
                                <i class="fas fa-box-open no-data-icon"></i>
                                <h5 class="text-muted">No inventory items found</h5>
                                <p class="mb-0">Add items to your inventory to see them here</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Category Breakdown -->
    <div class="section-card">
        <div class="section-header">
            <h3><i class="fas fa-tags"></i> Category Analysis</h3>
            <span class="section-badge">{{ category_summary|length }} Categories</span>
        </div>
        <div class="category-summary-grid">
            {% for category in category_summary %}
            <div class="category-item">
                <div class="category-name">
                    <span>{{ category.category }}</span>
                    <span class="badge bg-primary rounded-pill">{{ category.item_count }}</span>
                </div>
                <div class="category-stats">
                    <span><i class="fas fa-box me-1"></i> Stock: {{ category.total_stock }} units</span>
                    <span><i class="fas fa-rupee-sign me-1"></i> Value: {{ format_rupees(category.inventory_value) }}</span>
                    <span><i class="fas fa-chart-line me-1"></i> Sold: {{ category.total_sold }} units</span>
                    <span><i class="fas fa-percentage me-1"></i> Potential: {{ format_rupees(category.potential_value) }}</span>
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        {% set total_items = category.total_stock + category.total_sold %}
                        {% if total_items > 0 %}
                            {{ ((category.total_sold / total_items) * 100)|round(1) }}%
                        {% else %}
                            0%
                        {% endif %}
                        sell-through rate
                    </small>
                </div>
            </div>
            {% else %}
            <div class="no-data-card w-100">
                <i class="fas fa-tags no-data-icon"></i>
                <h5 class="text-muted">No categories found</h5>
                <p class="mb-0">Add categories to organize your inventory</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Stock Movements -->
    {% if recent_movements %}
    <div class="section-card">
        <div class="section-header">
            <h3><i class="fas fa-history"></i> Recent Stock Movements</h3>
            <span class="section-badge">Last 10 Activities</span>
        </div>
        <div class="p-3">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead style="background-color: var(--light-blue);">
                        <tr>
                            <th>Date & Time</th>
                            <th>Item</th>
                            <th>Type</th>
                            <th>Quantity</th>
                            <th>Previous Stock</th>
                            <th>New Stock</th>
                            <th>Changed By</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for movement in recent_movements %}
                        <tr>
                            <td>
                                {% if movement.created_date %}
                                    <small>{{ movement.created_date[:10] if movement.created_date|length > 10 else movement.created_date }}</small>
                                    {% if movement.created_date|length > 10 %}
                                        <br><small class="text-muted">{{ movement.created_date[11:19] }}</small>
                                    {% endif %}
                                {% else %}
                                    <small class="text-muted">N/A</small>
                                {% endif %}
                            </td>
                            <td>
                                <strong>{{ movement.item_name }}</strong><br>
                                <small class="text-muted">{{ movement.item_code or 'N/A' }}</small>
                            </td>
                            <td>
                                {% if movement.transaction_type == 'sale' %}
                                    <span class="badge bg-danger">Sale</span>
                                {% elif movement.transaction_type == 'purchase' %}
                                    <span class="badge bg-success">Purchase</span>
                                {% elif movement.transaction_type == 'return' %}
                                    <span class="badge bg-warning">Return</span>
                                {% else %}
                                    <span class="badge bg-info">{{ movement.transaction_type or 'N/A' }}</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if movement.transaction_type == 'sale' %}
                                    <span class="text-danger">-{{ movement.quantity }}</span>
                                {% else %}
                                    <span class="text-success">+{{ movement.quantity }}</span>
                                {% endif %}
                            </td>
                            <td class="text-center">{{ movement.previous_stock or 0 }}</td>
                            <td class="text-center">
                                <strong>{{ movement.new_stock or 0 }}</strong>
                            </td>
                            <td>
                                <small>{{ movement.created_by or 'System' }}</small>
                            </td>
                            <td>
                                <small class="text-muted">{{ movement.notes|truncate(30) if movement.notes else 'No notes' }}</small>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add animation to stat cards on load
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
        
        // Add hover effect to table rows
        const tableRows = document.querySelectorAll('.inventory-table tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseenter', function() {
                if (!this.classList.contains('low-stock') && !this.classList.contains('out-of-stock')) {
                    this.style.backgroundColor = 'rgba(0, 102, 204, 0.03)';
                }
            });
            
            row.addEventListener('mouseleave', function() {
                if (!this.classList.contains('low-stock') && !this.classList.contains('out-of-stock')) {
                    this.style.backgroundColor = '';
                }
            });
        });
        
        // Update report time
        function updateReportTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-IN', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true 
            });
            const dateString = now.toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            const timeElement = document.querySelector('.report-header small');
            if (timeElement) {
                timeElement.textContent = `Last updated: ${dateString} ${timeString}`;
            }
        }
        
        // Update time every minute
        updateReportTime();
        setInterval(updateReportTime, 60000);
        
        // Auto-refresh page every 30 minutes (for live updates)
        setTimeout(() => {
            window.location.reload();
        }, 30 * 60 * 1000); // 30 minutes
        
        // Print optimization
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
        });
        
        // Export functionality
        const exportPDFBtn = document.querySelector('.btn-export.pdf');
        if (exportPDFBtn) {
            exportPDFBtn.addEventListener('click', function(e) {
                // Show loading state
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                this.disabled = true;
                
                // Restore button after 3 seconds
                setTimeout(() => {
                    this.innerHTML = originalHTML;
                    this.disabled = false;
                }, 3000);
            });
        }
    });
</script>
{% endblock %}